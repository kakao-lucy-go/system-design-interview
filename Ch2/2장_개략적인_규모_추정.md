# 2장 개략적인 규모 추정

개략적인 규모 추정(back-of-the-envelop esimation)은 보편적으로 통용되는 성능 수치상에서 사고 실험(thought experiments)을 행하여 추정치를 계산하는 행위로서, 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것이다.

효과적으로 규모 추정을 하려면 규모 확장성을 표현하는데 필요한 기본기에 능숙해야 한다. 특히 2의 제곱수나 응답지연값, 가용성에 관계된 수치들을 이해해야 한다.

## 2.1 2의 제곱수

데이터 볼륨의 단위를 2의 제곱수로 표현하는지를 알아야 한다. 데이터의 최소 단위는 1바이트이고, 8비트로 구성된다. 아스키 문자 하나가 차지하는 메모리 크기는 1바이트이다.

| 2의 x 제곱 | 근사치 | 이름 | 축약형 |
| --- | --- | --- | --- |
| 10 | 1천 | 1킬로바이트 | 1KB |
| 20 | 1백만 | 1메가바이트 | 1MB |
| 30 | 10억 | 1기가바이트 | 1GB |
| 40 | 1조 | 1테라바이트 | 1TB |
| 50 | 1000wh | 1vpxkqkdlxm | 1PB |

## 2.2 응답지연 값

구글의 제프 딘이 2010년에 컴퓨터 연산들의 응답지연값을 공개한 바 있다. 이들 중 몇개는 더이상 유효하지 않게 되었지만 아직도 컴퓨터의 처리 속도를 짐작할 수 있게 해준다.

| 연산명 | 시간 |
| --- | --- |
| L1 캐시 참조 | 0.5ns |
| 분기 예측 오류(branch mispredict) | 5ns |
| L2 캐시 참조 | 7ns |
| 뮤텍스(mutex) 락/언락 | 100ns |
| 주 메모리 참조 | 100ns |
| Zippy로 1KB 압축 | 10,000ns |
| 1 Gbps 네트워크로 2KB 전송 | 20,000ns |
| 메모리에서 1MB 순차적으로 read | 250,000ns |
| 같은 데이터 센터 내에서의 메시지 왕복 지연 시간 | 500,000ns |
| 디스크 탐색 | 10,000,000ns = 10ms |
| 네트워크에서 1MB 순차적으로 read | 10,000,000ns = 10ms |
| 디스크에서 1MB 순차적으로 read | 30,000,000ns = 30ms |
| 한 패킷의 CA(캘리포니아)로부터 네덜란드까지 왕복 지연시간 | 150,000,000ns = 150ns |

결론

1. 메모리는 빠르지만 디스크는 아직도 느리다.
2. 디스크 탐색은 가능한 피하라.
3. 단순한 압축 알고리즘은 빠르다.
4. 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
5. 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

## 2.3 가용성에 관계된 수치들

고가용성은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어다. 고가용성을 표현하는 값은 퍼센트로 표현하고, 100%는 단 한번도 중단된 적 없었음을 의미하며 대부분은 99~100%이다.

SLA(Service Level Agreement)는 서비스 사업자(service provider)가 보편적으로 사용하는 용어로, 서비스 사업자와 고객 사이에 맺어진 합의를 의미한다. 이 합의에는 서비스 사업자가 제공하는 서비스의 가용시간이 공식적으로 기술되어있고, 아마존, 구글 등은 99% 이상의 SLA를 제공한다. 관습적으로 9가 많으면 많을수록 좋다고 본다.

| 가용률 | 하루당 장애시간 | 주당 장애시간 | 개월당 장애시간 | 연간 장애시간 |
| --- | --- | --- | --- | --- |
| 99% | 14.40분 | 1.68시간 | 7.31시간 | 3.65일 |
| 99.9% | 1.44분 | 10.08분 | 43.83분 | 8.77시간 |
| 99.99% | 8.64초 | 1.01분 | 4.38분 | 52.60분 |
| 99.999% | 864.00밀리초 | 6.05초 | 26.30초 | 5.26분 |
| 99.9999% | 86.40밀리초 | 604.80밀리초 | 2.63초 | 31.56초 |

## 2.4 예제: 트위터 QPS와 저장소 요구량 추정

가정

- 월간 능동 사용자는 3억명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년간 보관된다.

추정

QPS(Query Per Second) 추정치

- 일간 능동 사용자 = 3억 * 50% = 1.5억
- QPS = 1.5억 * 2트윗 / 24시간 / 3600초 = 약 3500
- 최대 QPS = 2 * QPS = 약 7000

미디어 저장을 위한 저장소 요구량

- 평균 트윗 크기
    - tweeit_id에 64바이트
    - 텍스트에 140바이트
    - 미디어에 1MB
- 미디어 저장소 요구량 : 1.5억 * 2 * 10% * 1MB = 30TB/일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB * 365 * 5 = 약 55PB

## 2.5 팁

결과를 내는 것 보다 올바른 절차를 밟는 것이 더 중요하다.

- 근사치를 활용한 계산을 통해 시간을 절약한다.
- 가정을 적어두고 나중에 살펴본다.
- 단위를 적는다.
- 많이 출제되는 개략적 규모 추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것이다.
